<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>9StarMaxå ±åƒ¹å–®</title>
<meta name="description" content="9Starmax ç–æ˜Ÿå‰åœ‹éš›è²¿æ˜“å°ˆæ¥­å ±åƒ¹å–®ç³»çµ±ï¼Œæä¾›å®Œæ•´çš„å•†å“å ±åƒ¹ã€å®¢æˆ¶ç®¡ç†åŠè¨‚å–®è™•ç†æœå‹™ã€‚">
<meta name="keywords" content="9Starmax,ç–æ˜Ÿå‰,åœ‹éš›è²¿æ˜“,å ±åƒ¹å–®,å•†å“å ±åƒ¹">
<meta name="author" content="9Starmax ç–æ˜Ÿå‰åœ‹éš›è²¿æ˜“">

<!-- Open Graph ç¤¾ç¾¤åª’é«”å„ªåŒ– -->
<meta property="og:title" content="9StarMaxå ±åƒ¹å–®">
<meta property="og:description" content="å°ˆæ¥­çš„å•†å“å ±åƒ¹å–®ç³»çµ±ï¼Œè¼•é¬†ç®¡ç†å®¢æˆ¶è³‡è¨Šèˆ‡å•†å“å ±åƒ¹">
<meta property="og:type" content="website">
<meta property="og:url" content="https://9starmax.com">

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”¯</text></svg>">

<style>
/* CSS è®Šæ•¸å®šç¾© */
:root {
  --primary: #1e3a8a;
  --secondary: #4b5e7a;
  --accent: #3b82f6;
  --bg-light: #f8fafc;
  --bg-highlight: #f1f5f9;
  --text: #111827;
  --text-light: #6b7280;
  --border: #e5e7eb;
  --success: #15803d;
  --danger: #e53e3e;
}

/* å…¨åŸŸé‡ç½® */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
  -ms-overflow-style: none;
  scrollbar-width: none;
}

body {
  background-color: var(--bg-light);
  color: var(--text);
  line-height: 1.5;
  font-size: 14px;
}

/* éš±è—æ»¾å‹•æ¢ */
::-webkit-scrollbar {
  width: 0;
  height: 0;
  background: transparent;
}

/* ä¸»å®¹å™¨ */
.container {
  max-width: 1000px;
  margin: 0 auto;
  background-color: #fff;
  box-shadow: 0 0 20px rgba(0, 0, 0, .1);
}

.section {
  border: none !important;
}

.quote-info, .bank-totals-section, .legal-terms-section, .signature-section {
  background-color: var(--bg-highlight);
}

/* æ¨™é¡Œå€åŸŸ */
.header {
  background-color: var(--primary);
  color: #fff;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  position: relative;
}

.company-logo {
  position: relative;
  cursor: pointer;
}

.company-logo:hover {
  opacity: .9;
}

.company-logo img {
  max-height: 50px;
  object-fit: contain;
}

.upload-logo {
  position: absolute;
  width: .1px;
  height: .1px;
  opacity: 0;
  z-index: -1;
}

.company-info p {
  opacity: .9;
  margin-bottom: 2px;
  line-height: 1.3;
}

.default-logo-text {
  font-size: 22px;
  font-weight: 600;
  color: #fff;
}

/* æ–‡ä»¶æ¨™é¡Œ */
.document-title h2 {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 2px;
  margin-left: -20px;
}

.document-title p {
  color: rgba(255, 255, 255, .9);
  margin-bottom: 2px;
  line-height: 1.3;
}

/* æ—¥æœŸé¡¯ç¤º */
.date-display {
  cursor: pointer;
  transition: opacity .2s;
  border-bottom: 1px dashed rgba(0, 0, 0, .3);
  padding-bottom: 1px;
  background-color: transparent;
}

.date-display:hover {
  opacity: .8;
  border-bottom: 1px dashed rgba(0, 0, 0, .6);
}

.document-title .date-display, .document-title .editable-field {
  color: #fff;
  border-bottom: 1px dashed rgba(255, 255, 255, .5);
}

.document-title .date-display:hover {
  border-bottom: 1px dashed rgba(255, 255, 255, .8);
}

.hidden-date-input {
  position: absolute;
  opacity: 0;
  width: 1px;
  height: 1px;
  overflow: hidden;
  z-index: -1;
}

.content .date-display {
  color: var(--text);
  border-bottom: 1px dashed var(--accent);
  display: inline-block;
  width: auto;
  min-width: 0;
}

#quoteDateText, #quoteValidText, #deliveryDateText {
  padding-right: 2px;
}

/* å ±åƒ¹è³‡è¨Šå€åŸŸ */
.quote-info {
  padding: 6px 16px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

/* å€å¡Šæ¨™é¡Œ */
.section-title, .section-title-with-controls {
  position: relative;
  padding-bottom: 2px;
  height: 20px;
  margin-bottom: 2px;
  box-sizing: border-box;
}

.section-title {
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--primary);
  font-weight: 600;
  display: flex;
  align-items: center;
}

.section-title:after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  width: 36px;
  height: 2px;
  background-color: var(--accent);
}

/* è³‡è¨Šç¾¤çµ„ */
.info-group {
  margin-bottom: 6px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.info-group h4 {
  font-size: 14px;
  margin-bottom: 3px;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.info-group p {
  color: var(--text-light);
  margin-bottom: 4px;
  line-height: 1.4;
  word-wrap: break-word;
}

.info-label {
  font-weight: 600;
  display: inline-block;
  margin-right: 0;
}

.client-info .info-label {
  width: auto;
  min-width: 40px;
}

.quote-meta-row {
  margin-bottom: 6px;
  line-height: 1.2;
}

/* å¯ç·¨è¼¯æ¬„ä½ */
[contenteditable=true], .editable-field {
  border-bottom: none;
  padding: 1px;
  min-height: 18px;
  min-width: 80px;
  display: inline-block;
  color: var(--text);
  background-color: transparent;
  cursor: text;
}

/* é›»è©±è™Ÿç¢¼æ¬„ä½è¼¸å…¥å„ªåŒ– */
[data-type="phone"] {
  font-family: monospace, Arial, sans-serif;
}

[contenteditable=true]:hover, .editable-field:hover {
  background-color: rgba(59, 130, 246, .1);
}

[contenteditable=true]:focus, .editable-field:focus {
  outline: none;
  border-bottom: 1px dashed var(--accent);
  background-color: rgba(59, 130, 246, .1);
}

/* å•†å“æ˜ç´°å€åŸŸ */
.items-section{padding:8px 20px}
.section-title-with-controls{display:flex;align-items:center;justify-content:space-between;margin-bottom:5px;padding-bottom:5px;border-bottom:1px solid var(--border)}
.items-controls{display:flex;align-items:center;gap:6px;margin-left:10px}
.row-btn{background:none;border:none;cursor:pointer;font-size:18px;font-weight:700;width:24px;height:24px;text-align:center;line-height:20px;transition:all .2s;padding:0}
.row-btn.add{color:var(--success)}
.row-btn.delete{color:var(--danger)}
.row-btn:hover{transform:scale(1.15);opacity:.85}

/* è¡¨æ ¼æ¨£å¼ */
table{width:100%;border-collapse:collapse;margin-top:8px;border-radius:5px;overflow:hidden;box-shadow:0 1px 5px rgba(0,0,0,.03);border:none}
table th{background-color:var(--primary);color:#fff;text-align:left;padding:4px 6px;font-weight:600;font-size:13px;border:none;letter-spacing:.5px}
table th:first-child{border-top-left-radius:5px}
table th:last-child{border-top-right-radius:5px}
table td{padding:3px 6px;border:none;border-bottom:1px solid var(--border);vertical-align:middle;transition:all .2s ease}
table tbody tr{background-color:#fff;transition:all .2s ease}
table tbody tr:nth-child(even){background-color:var(--bg-light)}
table tbody tr:hover{background-color:var(--bg-highlight);box-shadow:0 0 3px rgba(0,0,0,.03) inset}
table tbody tr:last-child td{border-bottom:none}
table tbody tr:last-child td:first-child{border-bottom-left-radius:5px}
table tbody tr:last-child td:last-child{border-bottom-right-radius:5px}

/* è¼¸å…¥æ¬„ä½æ¨£å¼ */
.text-center{text-align:center}
.input-field{width:100%;padding:2px 4px;border:none;border-radius:3px;font-size:12px;transition:all .2s ease;background-color:transparent}
.price-input{text-align:center;font-weight:500;color:var(--primary)}
.quantity-input,.shipping-input,.installation-input,.unit-input{text-align:center}
.input-field:focus{outline:none;background-color:rgba(59,130,246,.08);box-shadow:0 0 0 1px rgba(59,130,246,.2)}
.input-field:hover{background-color:rgba(241,245,249,.5)}
.category-input{font-weight:500;color:var(--secondary)}
.name-input{font-weight:500}
.quantity-input::-webkit-inner-spin-button,.quantity-input::-webkit-outer-spin-button{
    -webkit-appearance:none;
    appearance: none;
    margin:0
}
.quantity-input{
    -moz-appearance:textfield;
    -webkit-appearance: none;
    appearance:none
}
.original-price{text-decoration:line-through;color:var(--text-light);font-size:11px;display:block;text-align:center;padding-top:2px;opacity:.7}

#quoteTable .price-input,
#quoteTable .quantity-input,
#quoteTable .unit-input,
#quoteTable .installation-input,
#quoteTable .shipping-input {
  text-align: center;
  font-weight: 500;
  padding: 2px 1px;
  width: 100%;
  min-width: 50px;
  box-sizing: border-box;
}

#quoteTable .price-input {
  color: var(--primary);
}

/* éŠ€è¡Œèˆ‡ç¸½è¨ˆå€åŸŸ */
.bank-totals-section{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:8px 20px;align-items:start}
.legal-terms-section{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:8px 20px;align-items:stretch}
.flex-column-container{display:flex;flex-direction:column;padding:0;margin:0}
.content-box-light{background-color:var(--bg-light);border:1px solid var(--border);border-radius:4px;padding:8px;font-size:13px;color:var(--text-light);line-height:1.4;box-shadow:0 1px 3px rgba(0,0,0,.1);overflow:visible;height:auto}
.content-box-white{background-color:#fff;border:1px solid var(--border);border-radius:4px;font-size:14px;color:var(--text-light);line-height:1.3;box-shadow:0 1px 3px rgba(0,0,0,.1);overflow:visible}

/* æ¢æ¬¾å€åŸŸ */
.terms-container{margin-bottom:6px;flex-shrink:0}
.terms-content{height:auto!important;overflow-y:visible!important;padding:8px 8px 4px;display:block;box-sizing:border-box}
.terms-list{padding-left:16px;padding-bottom:0;list-style-type:disc;margin:0;width:100%;font-size:12px}
.terms-list li{margin-bottom:2px;padding-bottom:0;line-height:1.25;font-size:12px}
.terms-list li:last-child{margin-bottom:0}

/* å³å´å®¹å™¨èˆ‡å‚™è¨»å€åŸŸ */
.right-side-container{display:flex;flex-direction:column;height:100%}
.notes-container {
    position: relative;
    width: 100%;
    padding: 0;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    margin-top: 6px;
    height: 100%;
}

.notes-input-wrapper {
    position: relative;
    width: 100%;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    margin-top: 3px;
    height: 100%;
}

#notes-textarea {
    width: 100%;
    margin: 0;
    padding: 12px;
    height: 100%;
    min-height: 100%;
    font-size: 12px;
    line-height: 1.4;
    font-family: Arial, sans-serif;
    border: 1px solid var(--border);
    border-radius: 4px;
    background-color: var(--bg-light);
    color: var(--text-light);
    resize: none;
    box-sizing: border-box;
    overflow-y: auto;
    -webkit-appearance: none;
    appearance: none;
    transition: border-color 0.2s, box-shadow 0.2s;
}

#notes-textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#notes-textarea::placeholder {
    color: var(--text-light);
    opacity: 0.7;
}

/* æ³•å¾‹è²æ˜å€åŸŸ */
.legal-notice-container{height:100%;display:flex;flex-direction:column}
.legal-notice{height:100%;flex-grow:1;display:flex;flex-direction:column;overflow:visible}
.legal-notice h4{color:var(--primary);margin-bottom:4px;font-size:15px}
.legal-notice p{margin-bottom:5px}
.warranty-term-table{width:100%;border-collapse:collapse;margin:4px 0}
.warranty-term-table td{padding:3px 5px;border:1px solid var(--border);font-size:12px}
.warranty-term-table .term-label{width:20%;font-weight:600;background-color:rgba(75,94,122,.1);color:var(--primary)}

/* ç¸½è¨ˆè¡¨æ ¼ */
.totals-table{width:100%;border:none;background-color:#fff;border-radius:4px;display:flex;flex-direction:column;justify-content:space-between;height:100%}
.totals-row{height:24px;display:flex;align-items:center;flex:1}
.totals-row.totals-final{border-top:1px solid var(--border);padding-top:3px;height:28px;margin-top:auto}
.totals-label{width:60%;color:var(--text-light);font-size:13px;padding-left:5px}
.totals-value{width:40%;text-align:right;font-weight:600;font-size:13px;padding-right:5px}

.clean-select{
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance:none;
    border:none;
    background:transparent;
    width:100%;
    font-size:13px;
    font-weight:600;
    color:var(--text-light);
    cursor:pointer;
    outline:none;
    line-height:1.2
}

.totals-input {
  width: 100%;
  text-align: right;
  border: none;
  background: transparent;
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  padding: 0 5px;
  min-width: 80px;
  transition: all 0.2s ease;
}

.totals-input:focus {
  outline: none;
  background-color: rgba(59,130,246,.08);
  box-shadow: 0 0 0 1px rgba(59,130,246,.2);
}

.totals-input:hover {
  background-color: rgba(241,245,249,.5);
}

/* éŠ€è¡Œè³‡è¨Šèˆ‡ç¸½è¨ˆå®¹å™¨ */
.bank-info-container,.totals-container{height:180px;display:flex;flex-direction:column}
.bank-info,.totals-table{box-sizing:border-box;padding:6px 8px;flex-grow:1;display:flex;flex-direction:column;margin-top:3px}
.bank-info .info-group{margin:0;display:flex;flex-direction:column;justify-content:space-between;height:100%}
.bank-info .info-label{width:75px;font-weight:600;font-size:15px;display:inline-block;color:var(--text-light);line-height:1.2}
.bank-info .info-group p{font-size:15px;line-height:1.2;margin-bottom:0;padding:2px 0;height:24px;display:flex;align-items:center;overflow:hidden}
.bank-info span[contenteditable="true"]{font-size:15px;font-weight:600;line-height:1.2;min-height:18px;display:inline-block;overflow:hidden}
.bank-info span{font-size:15px;font-weight:600;line-height:1.2;min-height:18px;display:inline-block;overflow:hidden;color:var(--text)}

/* ç°½åå€åŸŸ */
.signature-section{width:100%;display:flex;justify-content:space-between;padding:8px 20px;gap:15px;align-items:stretch}
.staff-info,.client-confirmation{width:calc(50% - 7.5px);text-align:left;background-color:#fff;padding:8px;border:1px solid var(--border);border-radius:4px;display:flex;flex-direction:column;height:100%;min-height:120px}
.staff-info .info-group,.client-confirmation .info-group{margin-top:2px;margin-bottom:0;flex:1;display:flex;flex-direction:column;justify-content:space-between;min-height:90px}
.staff-info .info-label,.client-confirmation .info-label{width:70px;display:inline-block;vertical-align:top}

/* é€šçŸ¥å½ˆçª— */
.notification-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s}
.notification-overlay.show{opacity:1;visibility:visible}
.notification-modal{background:#fff;border-radius:8px;width:90%;max-width:450px;box-shadow:0 10px 25px rgba(0,0,0,.25);transform:translateY(-20px);transition:transform .3s;overflow:hidden}
.notification-overlay.show .notification-modal{transform:translateY(0)}
.notification-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.notification-title{font-weight:600;font-size:18px;display:flex;align-items:center;gap:10px}
.notification-icon{display:flex;align-items:center;justify-content:center}
.notification-content{padding:20px 16px;font-size:16px;line-height:1.5}
.notification-footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end}
.notification-btn{background-color:var(--primary);color:#fff;border:none;border-radius:4px;padding:8px 16px;font-weight:600;cursor:pointer;transition:background-color .2s;font-size:14px}
.notification-btn:hover{background-color:#163172}
.notification-warning .notification-title{color:#f59e0b}
.notification-error .notification-title{color:var(--danger)}

/* å®¢æˆ¶è³‡è¨Šæ¨£å¼ */
.client-info{position:relative;transition:all .2s ease;padding:4px 8px;border-radius:4px;border:1px solid transparent;margin:-1px}
.client-info:hover{background-color:rgba(241,245,249,.5);border-color:var(--border);box-shadow:0 1px 4px rgba(0,0,0,.05)}
.client-info .section-title{color:var(--primary);font-weight:600;margin-bottom:5px;padding-bottom:2px;height:18px;font-size:13px}
.client-info .section-title:after{height:2px;width:32px}
.client-info .info-group h4{font-weight:600;color:var(--primary);margin-bottom:3px;font-size:14px}
.client-info .info-group p{margin-bottom:3px;line-height:1.3}
.client-info .editable-field{border-bottom:1px dashed rgba(203,213,225,.5);padding:1px 3px;border-radius:2px;transition:all .2s ease;min-width:100px;min-height:16px}
.client-info .editable-field:empty{min-height:18px;background-color:rgba(241,245,249,.3)}
.client-info p:last-child{margin-bottom:1px}

.client-info .info-group p,
.client-info .info-group h4 {
    display: block;
    width: 100%;
    margin: 0;
    padding: 0;
    line-height: 1.1;
}

.client-info .info-group p {
    color: var(--text-light);
    word-wrap: break-word;
    margin-bottom: 2px;
    line-height: 1.3;
    display: flex;
    align-items: center;
    gap: 2px;
}

.client-info .info-group h4:nth-of-type(1) {
    font-weight: 600;
    color: var(--primary);
    font-size: 18px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.1;
    margin-bottom: 2px;
}

.client-info .info-group h4:nth-of-type(2) {
    font-weight: normal;
    color: var(--text);
    font-size: 14px;
    white-space: normal;
    overflow: visible;
    text-overflow: clip;
    line-height: 1.2;
    margin-top: 2px;
    margin-bottom: 2px;
}

.client-info .info-label {
    font-weight: 600;
    display: inline-block;
    margin-right: 0;
    min-width: 40px;
    padding-right: 0;
}

.client-info .editable-field {
    border-bottom: 1px dashed rgba(203,213,225,.5);
    padding: 1px 3px;
    border-radius: 2px;
    transition: all .2s ease;
    min-width: 100px;
    min-height: 16px;
    margin-left: -6px;
    display: inline-block;
}

/* è¯çµ¡è³‡è¨Šèˆ‡å ±åƒ¹è©³æƒ… */
.contact-info,.quote-details{position:relative;padding:4px 8px;border-radius:4px;border:1px solid transparent;margin:-1px}
.contact-info:hover,.quote-details:hover{background-color:rgba(241,245,249,.5);border-color:var(--border);box-shadow:0 1px 4px rgba(0,0,0,.05)}
.contact-info .section-title,.quote-details .section-title{margin-bottom:5px;padding-bottom:2px;height:18px;font-size:13px}
.contact-info .info-group p,.quote-details .info-group p{margin-bottom:2px;line-height:1.3}
.quote-details .info-group{margin-top:4px}

/* æŒ‰éˆ•å€åŸŸ */
.button-section{padding:0 20px 10px;text-align:center;background-color:var(--bg-highlight);margin-top:0}
.button-section button{margin:0 10px;padding:8px 16px;background-color:var(--primary);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:600;transition:background-color .2s}
.button-section button:hover{background-color:#163172}

/* æ‰“å°æ¨£å¼ */
@media print {
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
  
  body, html {
    margin: 0;
    padding: 0;
    background-color: #fff !important;
    width: 100%;
    font-size: 12px !important;
  }
  
  .container {
    width: 100% !important;
    max-width: none !important;
    margin: 0 !important;
    box-shadow: none !important;
    padding: 0 !important;
  }
  
  .header {
    background-color: var(--primary) !important;
    color: #fff !important;
    padding: 5px 10px !important;
  }
  
  .header * {
    color: #fff !important;
  }
  
  .company-logo img {
    max-height: 40px !important;
  }
  
  .default-logo-text {
    font-size: 18px !important;
  }
  
  .document-title h2 {
    font-size: 16px !important;
    margin-bottom: 1px !important;
  }
  
  .document-title p {
    margin-bottom: 1px !important;
    line-height: 1.2 !important;
  }
  
  .quote-info {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 5px !important;
    padding: 3px 10px !important;
    background-color: var(--bg-highlight) !important;
  }
  
  .client-info, .contact-info, .quote-details {
    padding: 2px 5px !important;
  }
  
  .section-title {
    margin-bottom: 1px !important;
    height: 15px !important;
    font-size: 12px !important;
  }
  
  .info-group p {
    margin-bottom: 2px !important;
    line-height: 1.2 !important;
  }
  
  table th {
    background-color: var(--primary) !important;
    color: #fff !important;
    padding: 2px 4px !important;
    font-size: 11px !important;
  }
  
  table td {
    padding: 1px 4px !important;
  }
  
  #quoteTable {
    width: 100% !important;
    table-layout: fixed !important;
    page-break-inside: auto !important;
    border-collapse: collapse !important;
    border: 1px solid var(--border) !important;
    margin-top: 3px !important;
  }
  
  #quoteTable th, #quoteTable td {
    box-sizing: border-box !important;
    overflow: visible !important;
    page-break-inside: avoid !important;
  }
  
  #itemsTableBody tr {
    display: table-row !important;
    visibility: visible !important;
    height: auto !important;
    min-height: 18px !important;
  }
  
  .input-field {
    background-color: transparent !important;
    border: none !important;
    min-height: 12px !important;
    font-size: 10px !important;
    padding: 1px 2px !important;
    display: block !important;
    width: 100% !important;
  }
  
  .bank-totals-section {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 5px !important;
    padding: 3px 10px !important;
    align-items: stretch !important;
  }
  
  .bank-info-container, .totals-container {
    height: auto !important;
    min-height: 120px !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  .bank-info, .totals-table {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: space-between !important;
    padding: 4px 6px !important;
    box-sizing: border-box !important;
    background-color: #fff !important;
    border: 1px solid var(--border) !important;
    border-radius: 4px !important;
    margin-top: 0 !important;
    height: 100% !important;
  }
  
  .bank-info .info-group {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: space-between !important;
    margin: 0 !important;
  }
  
  .totals-table {
    height: 100% !important;
  }
  
  .totals-row {
    height: 18px !important;
    display: flex !important;
    align-items: center !important;
    flex: 1 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  
  .totals-row.totals-final {
    height: 18px !important;
    padding-top: 0 !important;
    margin-top: auto !important;
    border-top: 1px solid var(--border) !important;
  }
  
  .totals-label, .totals-value {
    font-size: 12px !important;
    line-height: 1.1 !important;
  }
  
  .legal-terms-section {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 5px !important;
    padding: 3px 10px !important;
    background-color: var(--bg-highlight) !important;
    align-items: stretch !important;
  }
  
  .legal-notice h4 {
    font-size: 13px !important;
    margin-bottom: 2px !important;
  }
  
  .legal-notice p {
    font-size: 10px !important;
    margin-bottom: 3px !important;
    line-height: 1.2 !important;
  }
  
  .warranty-term-table td {
    padding: 2px 3px !important;
    font-size: 10px !important;
  }
  
  .terms-list {
    font-size: 10px !important;
  }
  
  .terms-list li {
    margin-bottom: 1px !important;
    line-height: 1.15 !important;
    font-size: 10px !important;
  }
  
  .legal-notice-container {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  .legal-notice {
    height: 100% !important;
    flex-grow: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: visible !important;
  }
  
  .notes-container {
    min-height: auto !important;
    margin-top: 3px !important;
    height: 100% !important;
    flex-grow: 1 !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  .notes-input-wrapper {
    width: 100% !important;
    flex-grow: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
  }
  
  #notes-textarea {
    display: block !important;
    width: 100% !important;
    font-size: 12px !important;
    line-height: 1.4 !important;
    background-color: var(--bg-light) !important;
    border: 1px solid var(--border) !important;
    border-radius: 4px !important;
    padding: 12px !important;
    color: var(--text-light) !important;
    font-family: Arial, sans-serif !important;
    box-sizing: border-box !important;
    height: 100% !important;
    min-height: 100% !important;
    resize: none !important;
    overflow-y: auto !important;
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    page-break-inside: avoid !important;
  }
  
  #notes-textarea::placeholder {
    opacity: 0 !important;
    color: transparent !important;
  }
  
  .signature-section {
    display: flex !important;
    flex-direction: row !important;
    justify-content: space-between !important;
    padding: 5px 10px !important;
    gap: 5px !important;
    background-color: var(--bg-highlight) !important;
  }
  
  .staff-info, .client-confirmation {
    width: 48% !important;
    background-color: #fff !important;
    padding: 5px !important;
    min-height: 120px !important;
    height: auto !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  .staff-info .info-group,
  .client-confirmation .info-group {
    min-height: 90px !important;
    height: auto !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: space-between !important;
  }
  
  .staff-info .info-label,
  .client-confirmation .info-label {
    width: 70px !important;
    display: inline-block !important;
    vertical-align: top !important;
  }
  
  .staff-info .editable-field,
  .client-confirmation .editable-field {
    display: inline-block !important;
    min-height: 18px !important;
    vertical-align: top !important;
  }
  
  @page {
    size: A4 portrait;
    margin: 0.5cm;
  }
  
  .section-title-with-controls {
    margin-bottom: 5px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    border-bottom: 1px solid var(--border) !important;
  }
  
  .items-controls, 
  .row-btn, 
  .row-btn.add,
  .row-btn.delete,
  #addItemBtn,
  #deleteItemBtn,
  .upload-logo, 
  .notification-overlay, 
  .button-section {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }
  
  .bank-info span[contenteditable="true"],
  .totals-value {
    font-size: 12px !important;
    font-weight: 600 !important;
    line-height: 1.1 !important;
    min-height: 16px !important;
    display: inline-block !important;
    overflow: hidden !important;
  }
  
  .totals-value {
    text-align: right !important;
    padding-right: 5px !important;
  }
  
  .bank-info .info-group p,
  .totals-row {
    height: 18px !important;
    display: flex !important;
    align-items: center !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  .client-info .info-group h4:nth-of-type(1) {
      font-size: 16px !important;
      line-height: 1.1 !important;
      margin-bottom: 2px !important;
  }
  
  .client-info .info-group h4:nth-of-type(2) {
      font-size: 12px !important;
      line-height: 1.2 !important;
      margin-top: 2px !important;
      margin-bottom: 2px !important;
  }
  
  .client-info .info-group p {
      margin-bottom: 2px !important;
      line-height: 1.2 !important;
  }

  .totals-input {
    border: none !important;
    background: transparent !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
  
  .totals-input:focus,
  .totals-input:hover {
    background: transparent !important;
    box-shadow: none !important;
  }
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 768px) {
  .container {
    margin: 0;
    box-shadow: none;
  }
  
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .quote-info {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .bank-totals-section,
  .legal-terms-section {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .signature-section {
    flex-direction: column;
    gap: 15px;
  }
  
  .staff-info,
  .client-confirmation {
    width: 100%;
  }
  
  table {
    font-size: 11px;
  }
  
  table th,
  table td {
    padding: 2px 3px;
  }
  
  .button-section button {
    display: block;
    width: 100%;
    margin: 5px 0;
  }
}
</style>
</head>
<body>
<div class="container">
<div class="header section">
<div class="company-info">
<div class="company-logo" id="logo-container"><span class="default-logo-text">ç–æ˜Ÿå‰åœ‹éš›è²¿æ˜“</span></div>
<input type="file" id="upload-logo" class="upload-logo" accept="image/*">
<p>çµ±ç·¨ï¼š89061654</p><p>é›»è©±ï¼š02-7709-4666</p><p>ä¿¡ç®±ï¼šService@9Starmax.com</p>
</div>
<div class="document-title">
<h2>å•†å“å ±åƒ¹å–®</h2>
<p>å ±åƒ¹å–®è™Ÿï¼š<span id="quoteNumber"></span></p>
<p id="quoteDateContainer">å ±åƒ¹æ—¥æœŸï¼š<span id="quoteDateText" class="date-display editable-field"></span><input type="date" id="quoteDate" class="hidden-date-input"></p>
<p id="quoteValidContainer">æœ‰æ•ˆæœŸé™ï¼š<span id="quoteValidText" class="date-display editable-field"></span><input type="date" id="quoteValidUntil" class="hidden-date-input"></p>
</div>
</div>
<div class="content">
<div class="quote-info section">
<div class="client-info">
<div class="section-title">å®¢æˆ¶è³‡è¨Š</div>
<div class="info-group">
<p><span class="info-label">çµ±ç·¨</span><span contenteditable="true" data-placeholder="è«‹è¼¸å…¥çµ±ç·¨" class="editable-field"></span></p>
<h4 contenteditable="true" data-placeholder="è«‹è¼¸å…¥å®¢æˆ¶åç¨±" class="editable-field"></h4>
<h4 contenteditable="true" data-placeholder="è«‹è¼¸å…¥å®¢æˆ¶åœ°å€" class="editable-field"></h4>
</div>
</div>
<div class="contact-info">
<div class="section-title">è¯çµ¡çª—å£</div>
<div class="info-group">
<p><span class="info-label">è¯çµ¡äººï¼š</span> <span contenteditable="true" data-placeholder="è«‹è¼¸å…¥è¯çµ¡äººè³‡è¨Š" class="editable-field"></span></p>
<p><span class="info-label">è¯çµ¡é›»è©±ï¼š</span> <span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼" data-type="phone" class="editable-field"></span></p>
<p><span class="info-label">é›»å­éƒµä»¶ï¼š</span> <span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" data-type="email" class="editable-field"></span></p>
</div>
</div>
<div class="quote-details">
<div class="section-title">å ±åƒ¹è³‡è¨Š</div>
<div class="info-group">
<p class="quote-meta-row"><span class="info-label">é è¨ˆäº¤æœŸï¼š</span><span id="deliveryDateText" class="date-display editable-field"></span><input type="date" id="deliveryDate" class="hidden-date-input"></p>
<p class="quote-meta-row"><span class="info-label">æ”¯ä»˜æ¢ä»¶ï¼š</span><span>ç¶“ç¢ºèªå ±åƒ¹å¾Œæ”¯ä»˜30%è¨‚é‡‘</span></p>
<p class="quote-meta-row"><span class="info-label" style="color:transparent">æ”¯ä»˜æ¢ä»¶ï¼š</span><span>å•†å“äº¤ä»˜å¾Œ<span contenteditable="true" data-placeholder="å¤©æ•¸" class="editable-field" style="min-width:20px;width:auto;display:inline-block;text-align:center;border-bottom:1px dashed var(--border);margin:0 2px;padding:0">30</span>å¤©å…§çµæ¸…å°¾æ¬¾</span></p>
</div>
</div>
</div>
<div class="items-section section">
<div class="section-title-with-controls">
  <div class="section-title">å ±åƒ¹å•†å“æ˜ç´°</div>
  <div class="items-controls">
    <button class="row-btn add" id="addItemBtn" title="æ–°å¢å•†å“">+</button>
    <button class="row-btn delete" id="deleteItemBtn" title="åˆªé™¤å•†å“">-</button>
  </div>
</div>
<div class="table-responsive">
<table id="quoteTable">
<thead>
<tr>
<th style="width:20%">ç¨®é¡</th>
<th style="width:32%">åç¨±</th>
<th style="width:9.6%" class="text-center">å–®åƒ¹</th>
<th style="width:9.6%" class="text-center">æ•¸é‡</th>
<th style="width:9.6%" class="text-center">å–®ä½</th>
<th style="width:9.6%" class="text-center">å®‰è£</th>
<th style="width:9.6%" class="text-center">é‹è²»</th>
</tr>
</thead>
<tbody id="itemsTableBody">
<tr>
<td><input type="text" class="category-input input-field" placeholder=""></td>
<td><input type="text" class="name-input input-field" placeholder=""></td>
<td style="text-align:center">
<input type="text" class="price-input input-field" value="">
<span class="original-price"></span>
</td>
<td class="text-center"><input type="number" class="quantity-input input-field" value="" min="0" step="0.01"></td>
<td class="text-center"><input type="text" class="unit-input input-field" value=""></td>
<td class="text-center"><input type="text" class="installation-input input-field" value=""></td>
<td class="text-center"><input type="text" class="shipping-input input-field" value=""></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="bank-totals-section section">
<div class="bank-info-container flex-column-container">
<div class="section-title">éŠ€è¡Œè³‡è¨Š</div>
<div class="bank-info content-box-white">
<div class="info-group">
<p><span class="info-label">é‡‘èæ©Ÿæ§‹ï¼š</span><span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é‡‘èæ©Ÿæ§‹" class="editable-field">ç¬¬ä¸€éŠ€è¡Œ</span></p>
<p><span class="info-label">æ©Ÿæ§‹åˆ†æ”¯ï¼š</span><span contenteditable="true" data-placeholder="è«‹è¼¸å…¥æ©Ÿæ§‹åˆ†æ”¯" class="editable-field">æ±æ¸¯åˆ†è¡Œ</span></p>
<p><span class="info-label">é‡‘èæˆ¶åï¼š</span><span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é‡‘èæˆ¶å" class="editable-field">ç–å‰ç™¼è²¿æ˜“è¡Œ</span></p>
<p><span class="info-label">é‡‘èä»£ç¢¼ï¼š</span><span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é‡‘èä»£ç¢¼" class="editable-field">007</span></p>
<p><span class="info-label">é‡‘èå¸³è™Ÿï¼š</span><span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é‡‘èå¸³è™Ÿ" class="editable-field">7521-0068-870</span></p>
</div>
</div>
</div>
<div class="totals-container flex-column-container">
<div class="section-title">ç¸½è¨ˆé‡‘é¡</div>
<div class="totals-table content-box-white">
<div class="totals-row"><span class="totals-label">å®‰è£åˆè¨ˆ</span><span class="totals-value"><input type="text" class="totals-input" id="totalInstallation" value="0"></span></div>
<div class="totals-row"><span class="totals-label">é‹è²»åˆè¨ˆ</span><span class="totals-value"><input type="text" class="totals-input" id="totalShipping" value="0"></span></div>
<div class="totals-row"><span class="totals-label">ç¨…é¡åˆè¨ˆ</span><span class="totals-value"><input type="text" class="totals-input" id="taxAmount" value="0"></span></div>
<div class="totals-row"><span class="totals-label">æ‡‰ä»˜è¨‚é‡‘</span><span class="totals-value"><input type="text" class="totals-input" id="depositAmount" value="0"></span></div>
<div class="totals-row totals-final">
<span class="totals-label">
<select id="taxType" class="clean-select">
<option value="untaxed" selected>æœªç¨…ç¸½è¨ˆé‡‘é¡</option>
<option value="taxed">æ‡‰ç¨…ç¸½è¨ˆé‡‘é¡</option>
</select>
</span>
<span class="totals-value"><input type="text" class="totals-input" id="grandTotal" value="0"></span>
</div>
</div>
</div>
</div>
<div class="legal-terms-section section">
<div class="legal-notice-container">
<div class="section-title">æ³•å¾‹è²æ˜èˆ‡æ³¨æ„äº‹é …</div>
<div class="legal-notice content-box-light">
<h4>å¥‘ç´„æ³•å¾‹é—œä¿‚èªªæ˜</h4>
<p>ä¾æ“šä¸­è¯æ°‘åœ‹æ°‘æ³•ç¬¬153æ¢åŠæ¶ˆè²»è€…ä¿è­·æ³•ç¬¬4æ¢è¦å®šï¼Œæœ¬å ±åƒ¹å–®ä¸€ç¶“è²´æ–¹æ¥å—ä¸¦ç¢ºèªï¼Œå³æ§‹æˆå…·æœ‰æ³•å¾‹ç´„æŸåŠ›ä¹‹è²·è³£å¥‘ç´„ï¼Œé›™æ–¹å‡æ‡‰ä¾èª ä¿¡åŸå‰‡å±¥è¡Œå¥‘ç´„ç¾©å‹™ã€‚</p>
<h4>å•†å“ç‘•ç–µè²¬ä»»</h4>
<p>ä¾æ“šæ°‘æ³•ç¬¬354æ¢åŠç¬¬355æ¢è¦å®šï¼Œæœ¬å…¬å¸å°±æ‰€å‡ºå”®ä¹‹å•†å“ï¼Œæ“”ä¿å…¶æ–¼å±éšªç§»è½‰æ™‚ç„¡æ»…å¤±æˆ–æ¸›å°‘å…¶åƒ¹å€¼ä¹‹ç‘•ç–µï¼Œä¸¦æ“”ä¿å…¶å…·æœ‰ç‰¹å®šä¿è­‰ä¹‹å“è³ªã€‚å¦‚æœ‰ç‘•ç–µï¼Œè²·æ–¹å¾—ä¾æ°‘æ³•ç¬¬359æ¢ä¸»å¼µæ¸›å°‘åƒ¹é‡‘æˆ–è§£é™¤å¥‘ç´„ã€‚</p>
<h4>ä¿å›ºèˆ‡ç¶­ä¿®è²¬ä»»</h4>
<div class="warranty-terms">
<table class="warranty-term-table">
<tr><td class="term-label">ä¿å›ºç¯„åœ</td><td>ä¾å•†å“ä¿å›ºæ›¸ç™»è¼‰ç‚ºæº–æœªç‰¹åˆ¥ç´„å®šè‡ªäº¤ä»˜æ—¥èµ·ç®—ä¸ƒæ—¥</td></tr>
<tr><td class="term-label">ä¿å›ºæœå‹™</td><td>ä¿å›ºæœŸå…§å› è£½é€ ç‘•ç–µæå£ï¼Œæä¾›å…è²»ç¶­ä¿®æˆ–æ›´æ›æœå‹™</td></tr>
<tr><td class="term-label">é™¤å¤–æƒ…å½¢</td><td>äººç‚ºã€å¤©ç½ã€æœªç¶“æˆæ¬Šæ‹†æ”¹æˆ–æ­£å¸¸è€—æå°è‡´æå£ä¸ä¿</td></tr>
<tr><td class="term-label">ç‰¹æ®Šç´„å®š</td><td>é™¤å€‹åˆ¥å ±åƒ¹å–®å…§å¦æœ‰ç´„å®šä¹‹äº‹é …æ¢æ¬¾è€…ï¼Œç‚ºå„ªå…ˆé©ç”¨</td></tr>
<tr><td class="term-label">æ³•å®šæ¬Šç›Š</td><td>ä¸å½±éŸ¿æ¶ˆè²»è€…ä¾ã€Šæ¶ˆè²»è€…ä¿è­·æ³•ã€‹äº«æœ‰çš„7å¤©é‘‘è³æœŸç­‰æ¬Šåˆ©</td></tr>
</table>
</div>
<h4>å€‹äººè³‡æ–™ä¿è­·è²æ˜</h4>
<p>ä¾æ“šå€‹äººè³‡æ–™ä¿è­·æ³•è¦å®šï¼Œæœ¬å…¬å¸è’é›†ã€è™•ç†åŠåˆ©ç”¨è²´æ–¹ä¹‹å€‹äººè³‡æ–™ï¼Œåƒ…é™æ–¼æœ¬äº¤æ˜“åŠå”®å¾Œæœå‹™ä¹‹ç›®çš„ç¯„åœå…§ã€‚è²´æ–¹äº«æœ‰æŸ¥è©¢ã€é–±è¦½ã€è¤‡è£½ã€è£œå……ã€æ›´æ­£ã€åˆªé™¤åŠåœæ­¢è’é›†è™•ç†åˆ©ç”¨ä¹‹æ¬Šåˆ©ã€‚</p>
<h4 style="margin-bottom:4px">ç‰ˆæ¬Šå…è²¬è²æ˜</h4>
<p style="margin-bottom:0">è‹¥è²´æ–¹æä¾›åœ–æ¨£ã€è¨­è¨ˆæˆ–å…¶ä»–å…§å®¹é€²è¡Œå®¢è£½åŒ–å•†å“è£½ä½œï¼Œè²´æ–¹éœ€ç¢ºä¿æ“æœ‰è©²ç­‰å…§å®¹ä¹‹åˆæ³•ä½¿ç”¨æ¬Šæˆ–è‘—ä½œæ¬Šã€‚å°æ–¼è²´æ–¹æä¾›ä¹‹ä»»ä½•å¯èƒ½æ¶‰åŠç¬¬ä¸‰æ–¹è‘—ä½œæ¬Šã€å•†æ¨™æ¬Šæˆ–å…¶ä»–æ™ºæ…§è²¡ç”¢æ¬Šä¹‹å…§å®¹ï¼Œæœ¬å…¬å¸ä¸è² å¯©æŸ¥ç¾©å‹™åŠä¾µæ¬Šè²¬ä»»ã€‚è‹¥å› æ­¤å°è‡´ä»»ä½•æ³•å¾‹çˆ­è­°æˆ–æå®³ï¼Œæ‡‰ç”±è²´æ–¹æ‰¿æ“”å…¨éƒ¨è²¬ä»»ä¸¦è³ å„Ÿæœ¬å…¬å¸å› æ­¤é­å—ä¹‹æå¤±ã€‚æœ¬å…¬å¸ä¿ç•™æ‹’çµ•è™•ç†ä»»ä½•ç–‘ä¼¼ä¾µæ¬Šå…§å®¹ä¹‹æ¬Šåˆ©ã€‚</p>
</div>
</div>
<div class="right-side-container">
<div class="terms-container">
<div class="section-title">åˆç´„æ¢æ¬¾èˆ‡æ¢ä»¶</div>
<div class="terms-content content-box-light">
<ul class="terms-list">
<li>æœ¬å ±åƒ¹å–®è‡ªé–‹ç«‹æ—¥èµ·7å¤©å…§æœ‰æ•ˆï¼Œé€¾æœŸæœªæ¥å—è€…è¦–ç‚ºè‡ªå‹•å¤±æ•ˆã€‚</li>
<li>æ”¿åºœæ©Ÿé—œã€å…¬ç«‹å­¸æ ¡æ¡è³¼é©ç”¨æ”¿åºœæ¡è³¼æ³•ç›¸é—œè¦å®šï¼Œå¦‚æœ‰ç‰´è§¸ï¼Œä»¥æ”¿åºœæ¡è³¼æ³•ç‚ºæº–ã€‚</li>
<li>å¯¦éš›äº¤ä»˜ä¹‹å•†å“é¡è‰²ã€ç´‹ç†å¯èƒ½å› ç”Ÿç”¢æ‰¹æ¬¡åŠè‡ªç„¶æè³ªç‰¹æ€§è€Œæœ‰äº›å¾®å·®ç•°ï¼Œæ­¤éå±¬ç”¢å“ç‘•ç–µã€‚</li>
<li>æ‰€æœ‰é‡‘é¡ä»¥æ–°å°å¹£è¨ˆåƒ¹ï¼ŒåŒ…å«åŸºæœ¬é‹é€èˆ‡å®‰è£è²»ç”¨ï¼Œä½†ä¸å«å› ç¾å ´ç‰¹æ®Šæƒ…æ³è¡ç”Ÿä¹‹é¡å¤–å·¥ç¨‹è²»ç”¨ã€‚</li>
<li>é©—æ”¶æ™‚è«‹ç¢ºå¯¦æª¢æŸ¥å•†å“å¤–è§€åŠåŠŸèƒ½ï¼Œç°½æ”¶å¾Œè¦–ç‚ºæ¥å—å•†å“ç¾æ³ã€‚å¦‚æœ‰æ˜é¡¯ç‘•ç–µï¼Œè«‹æ–¼é©—æ”¶æ™‚ç«‹å³æå‡ºã€‚</li>
<li>å ±åƒ¹å–®ç¢ºèªç„¡èª¤ï¼Œéœ€æ”¯ä»˜ç¸½é‡‘é¡30%ä½œç‚ºè¨‚é‡‘ï¼Œé¤˜æ¬¾æ”¯ä»˜æ–¹å¼è‹¥åˆç´„å¦æœ‰ç´„å®šå‰‡å¾å…¶ç´„å®šï¼Œå¦å‰‡æ‡‰æ–¼é©—æ”¶åˆæ ¼å¾Œ30æ—¥å…§ä»˜æ¸…ã€‚</li>
<li>æ¨™æº–äº¤æœŸç‚ºç¢ºèªè¨‚å–®å¾Œ4-8é€±ï¼Œå¯¦éš›äº¤æœŸå°‡ä¾è¨‚å–®ç¢ºèªæ›¸ç‚ºæº–ã€‚é‡åŸç‰©æ–™çŸ­ç¼ºæˆ–ä¸å¯æŠ—åŠ›å› ç´ ï¼Œäº¤æœŸå¯èƒ½é †å»¶ï¼Œæœ¬å…¬å¸å°‡ç«‹å³é€šçŸ¥ã€‚</li>
</ul>
</div>
</div>
<div class="notes-container">
<div class="section-title">å…¶ä»–å‚™è¨»</div>
<div class="notes-input-wrapper">
<textarea id="notes-textarea" placeholder="è«‹è¼¸å…¥é¡å¤–çš„å‚™è¨»æˆ–ç‰¹æ®Šéœ€æ±‚..."></textarea>
</div>
</div>
</div>
</div>
<div class="signature-section section">
<div class="staff-info" id="staff-info">
<div class="section-title" id="staff-title">éŠ·å”®æ–¹è³‡è¨Š</div>
<div class="info-group">
<p><span class="info-label">å§“åï¼š</span> <span contenteditable="true" class="editable-field"></span></p>
<p><span class="info-label">é›»è©±ï¼š</span> <span contenteditable="true" data-type="phone" class="editable-field">02-7709-4666</span></p>
<p><span class="info-label">ä¿¡ç®±ï¼š</span> <span contenteditable="true" data-type="email" class="editable-field">Service@9Starmax.com</span></p>
</div>
</div>
<div class="client-confirmation" id="client-confirmation">
<div class="section-title" id="client-title">æ¡è³¼æ–¹è³‡è¨Š</div>
<div class="info-group">
<p><span class="info-label">å§“åï¼š</span> <span contenteditable="true" data-placeholder="è«‹è¼¸å…¥å®¢æˆ¶å§“å" class="editable-field"></span></p>
<p><span class="info-label">é›»è©±ï¼š</span> <span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼" data-type="phone" class="editable-field"></span></p>
<p><span class="info-label">ä¿¡ç®±ï¼š</span> <span contenteditable="true" data-placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" data-type="email" class="editable-field"></span></p>
</div>
</div>
</div>
</div>
<div class="button-section">
<button id="previewBtn">ç”¢å‡ºé è¦½</button>
<button id="generateImageBtn">ç”¢å‡ºåœ–ç‰‡</button>
<button id="printPdfBtn">ç”¢å‡ºPDF</button>
</div>
</div>

<!-- CDN Script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded',()=>{
const C={TAX_RATE:.05,DEPOSIT_RATE:.3,DEFAULT_VALID_DAYS:7,DEFAULT_DELIVERY_DAYS:28,MAX_VALUE:999999999,MIN_VALUE:-999999999},M=["JA","FE","MR","AP","MY","JN","JL","AU","SE","OC","NO","DE"],T=new Date,d=e=>document.getElementById(e),D={quoteDateText:'quoteDate',quoteValidText:'quoteValidUntil',deliveryDateText:'deliveryDate'},b=(e,t)=>function(){let r;clearTimeout(r),r=setTimeout(()=>e.apply(this,arguments),t)},F={parseNumber:(e,t=!1)=>{if(!e)return 0;try{const r=String(e).replace(/[^\d.-]/g,'').trim(),n=t?parseInt(r):parseFloat(r);return isNaN(n)?0:Math.min(C.MAX_VALUE,Math.max(C.MIN_VALUE,n))}catch{return 0}},formatCurrency:e=>{try{return isNaN(e)?'0':(t=Math.round(Math.min(C.MAX_VALUE,Math.max(C.MIN_VALUE,e))),new Intl.NumberFormat('zh-TW',{style:'decimal',minimumFractionDigits:0}).format(t));var t}catch{return Math.round(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},formatText:(e,t)=>{if(!e)return'';if(t==="phone"){const cleanPhone=e.replace(/[^\d+\-() #,]/g,'').trim();if(cleanPhone.length===0)return'';return cleanPhone.substring(0,25)}if(t==="email")return e.replace(/\s/g,"").trim().substring(0,50);return e.trim().substring(0,500)},formatDate:e=>{if(!e)return'';try{return new Date(e).toLocaleDateString('zh-TW',{year:'numeric',month:'long',day:'numeric'})}catch{return e}}};

function setupPrintHandlers() {
  window.prepareDocumentForDisplay = function() {
    const quoteNumber = d('quoteNumber');
    if (quoteNumber && quoteNumber.textContent) {
      document.dataset = document.dataset || {};
      document.dataset.originalTitle = document.title;
      document.title = quoteNumber.textContent;
    }
    
    const textarea = d('notes-textarea');
    if (textarea) {
      textarea.style.height = '100%';
      textarea.style.minHeight = '100%';
      textarea.style.maxHeight = 'none';
    }
    
    document.querySelectorAll('[contenteditable="true"], .editable-field').forEach(el => {
      el.dataset.originalBorder = el.style.border;
      el.style.border = 'none';
      if (!el.textContent.trim()) {
        el.dataset.wasEmpty = "true";
        el.style.color = 'transparent';
      }
    });
    document.querySelectorAll('input.input-field').forEach(el => {
      if (!el.value) {
        el.dataset.wasEmpty = "true";
        el.style.color = 'transparent';
      }
    });
    const tableBody = d('itemsTableBody');
    if (tableBody) {
      const rows = tableBody.querySelectorAll('tr');
      const visibleRows = Array.from(rows).filter(row => 
        row.style.display !== 'none' && !row.dataset.hiddenForPrint
      );
      if (visibleRows.length < 5) {
        rows.forEach(row => {
          if (row.dataset.hiddenForPrint) {
            row.style.display = 'table-row';
            delete row.dataset.hiddenForPrint;
            delete row.dataset.wasEmpty;
          }
        });
        if (rows.length < 5) {
          const rowsToAdd = 5 - rows.length;
          for (let i = 0; i < rowsToAdd; i++) {
            const newRow = document.createElement('tr');
            newRow.innerHTML = rows[0].innerHTML;
            newRow.dataset.addedForPrint = "true";
            newRow.querySelectorAll('input').forEach(input => {
              input.value = '';
              input.style.border = 'none';
            });
            tableBody.appendChild(newRow);
          }
        }
      }
      tableBody.querySelectorAll('input').forEach(input => {
        if (!input.value.trim()) {
          input.style.border = 'none';
          input.style.minHeight = '14px';
        }
      });
    }
    document.querySelectorAll('.header, .header *, table th, .warranty-term-table .term-label').forEach(el => {
      el.style.webkitPrintColorAdjust = 'exact';
      el.style.printColorAdjust = 'exact';
    });
    const notification = document.querySelector('.notification-overlay.show');
    if (notification) {
      notification.classList.remove('show');
    }
    
    document.querySelectorAll('.items-controls, .row-btn, #addItemBtn, #deleteItemBtn').forEach(el => {
      el.style.display = 'none';
      el.style.visibility = 'hidden';
      el.style.opacity = '0';
    });
  };
  
  window.restoreDocumentAfterDisplay = function() {
    if (document.dataset && document.dataset.originalTitle) {
      document.title = document.dataset.originalTitle;
    }
    
    const textarea = d('notes-textarea');
    if (textarea) {
      textarea.style.height = '100%';
    }
    
    document.querySelectorAll('[contenteditable="true"], .editable-field').forEach(el => {
      if (el.dataset.originalBorder) {
        el.style.border = el.dataset.originalBorder;
        delete el.dataset.originalBorder;
      }
      if (el.dataset.wasEmpty === "true") {
        el.textContent = '';
        el.style.color = '';
        delete el.dataset.wasEmpty;
      }
    });
    document.querySelectorAll('input.input-field').forEach(el => {
      if (el.dataset.wasEmpty === "true") {
        el.value = '';
        el.style.color = '';
        delete el.dataset.wasEmpty;
      }
    });
    document.querySelectorAll('tr[data-hidden-for-print="true"]').forEach(row => {
      row.style.display = '';
      delete row.dataset.hiddenForPrint;
    });
    document.querySelectorAll('tr[data-added-for-print="true"]').forEach(row => {
      row.remove();
    });
    
    document.querySelectorAll('.items-controls, .row-btn, #addItemBtn, #deleteItemBtn').forEach(el => {
      el.style.display = '';
      el.style.visibility = '';
      el.style.opacity = '';
    });
  };

  window.addEventListener('beforeprint', window.prepareDocumentForDisplay);
  window.addEventListener('afterprint', window.restoreDocumentAfterDisplay);
}

function N(e,t='info'){if(!e)return null;const r=document.querySelector('.notification-overlay');r&&(r.classList.remove('show'),setTimeout(()=>r.remove(),300));const n=document.createElement('div');n.className=`notification-overlay notification-${t}`;let i='',s='é€šçŸ¥';t==='warning'?(i='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',s='æ³¨æ„'):t==='error'?(i='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e53e3e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',s='éŒ¯èª¤'):t==='success'?(i='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#15803d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',s='æˆåŠŸ'):i='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',n.innerHTML=`<div class="notification-modal"><div class="notification-header"><div class="notification-title"><span class="notification-icon">${i}</span><span>${s}</span></div></div><div class="notification-content">${e}</div><div class="notification-footer"><button class="notification-btn">æˆ‘çŸ¥é“äº†</button></div></div>`,document.body.appendChild(n),n.offsetHeight,n.classList.add('show');const c=n.querySelector('.notification-btn');c&&(c.addEventListener('click',()=>{n.classList.remove('show'),setTimeout(()=>n.remove(),300)}),setTimeout(()=>c.focus(),100));const l=e=>{(e.key==='Escape'||e.key==='Enter')&&(n.classList.remove('show'),setTimeout(()=>{n.remove(),document.removeEventListener('keydown',l)},300))};return document.addEventListener('keydown',l),n}

function y(e=T,t=''){try{const r=M[e.getMonth()],n=e.getFullYear().toString().slice(-2),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),c=Math.random().toString(36).substring(2,4).toUpperCase();return`${t}${r}-${n}${i}${s}${c}`}catch{return`${t}${Math.random().toString(36).substring(2,8).toUpperCase()}`}}function E(){try{const e=d('quoteDate'),t=e?.value||T.toISOString().split("T")[0],r=new Date(t),n=d('quoteNumber');n&&(n.textContent=y(r))}catch{}}function I(){
  try{
    const e=d('quoteDate'),
          t=d('quoteDateText');
    if(e&&t){
      e.value=T.toISOString().split("T")[0];
      t.textContent=F.formatDate(e.value);
      
      const r=new Date(e.value),
            n=d('quoteValidUntil'),
            i=d('quoteValidText');
      if(n&&i){
        const s=new Date(r);
        s.setDate(r.getDate()+C.DEFAULT_VALID_DAYS);
        n.value=s.toISOString().split("T")[0];
        i.textContent=F.formatDate(n.value);
      }
      
      const o=d('deliveryDate'),
            l=d('deliveryDateText');
      if(o&&l){
        const s=new Date(r);
        s.setDate(r.getDate()+C.DEFAULT_DELIVERY_DAYS);
        o.value=s.toISOString().split("T")[0];
        l.textContent=F.formatDate(o.value);
      }
    }
  }catch{}
  E();
}

function g(){const e=d('itemsTableBody');if(e)try{e.innerHTML='';for(let t=0;t<7;t++){const r=document.createElement("tr");r.innerHTML=`<td><input type="text" class="category-input input-field" placeholder=""></td><td><input type="text" class="name-input input-field" placeholder=""></td><td style="text-align:center"><input type="text" class="price-input input-field" value=""><span class="original-price"></span></td><td class="text-center"><input type="number" class="quantity-input input-field" value="" min="0" step="0.01"></td><td class="text-center"><input type="text" class="unit-input input-field" value=""></td><td class="text-center"><input type="text" class="installation-input input-field" value=""></td><td class="text-center"><input type="text" class="shipping-input input-field" value=""></td>`,e.appendChild(r)}f()}catch{}}function v(){const e=d('itemsTableBody');if(e)try{const t=document.createElement("tr");t.innerHTML=`<td><input type="text" class="category-input input-field" placeholder=""></td><td><input type="text" class="name-input input-field" placeholder=""></td><td style="text-align:center"><input type="text" class="price-input input-field" value=""><span class="original-price"></span></td><td class="text-center"><input type="number" class="quantity-input input-field" value="" min="0" step="0.01"></td><td class="text-center"><input type="text" class="unit-input input-field" value=""></td><td class="text-center"><input type="text" class="installation-input input-field" value=""></td><td class="text-center"><input type="text" class="shipping-input input-field" value=""></td>`,e.appendChild(t),f()}catch{}}function f(){
  const e=d('itemsTableBody'),
        r=d('totalShipping'),
        n=d('totalInstallation'),
        i=d('depositAmount'),
        s=d('grandTotal'),
        c=d('taxType'),
        l=d('taxAmount');
  if(!e||!s)return;
  let o=0,p=0,m=0;
  try{
    Array.from(e.children).forEach(u=>{
      const L=u.querySelector(".price-input"),
            w=u.querySelector(".quantity-input"),
            k=u.querySelector(".shipping-input"),
            B=u.querySelector(".installation-input");
      if(!L||!w)return;
      const V=F.parseNumber(L.value||"0"),
            W=Math.max(0,F.parseNumber(w.value||"0",!1)),
            O=F.parseNumber(k?.value||"0"),
            X=F.parseNumber(B?.value||"0");
      o+=Math.round(V*W);
      p+=O;
      m+=Math.round(X*W);
    });
    
    const updateTotalInput = (input, value) => {
      if (input) {
        input.value = F.formatCurrency(value);
      }
    };

    const y=o+p+m,
          x=c&&c.value==="taxed",
          U=x?Math.round(y*C.TAX_RATE):0,
          R=y+U,
          X=Math.round(R*C.DEPOSIT_RATE);

    updateTotalInput(n, m);
    updateTotalInput(r, p);
    updateTotalInput(l, U);
    updateTotalInput(i, X);
    updateTotalInput(s, R);
  }catch{}
}

function setupTotalsInputs() {
  const totalsInputs = document.querySelectorAll('.totals-input');
  
  totalsInputs.forEach(input => {
    input.addEventListener('input', (e) => {
      const value = F.parseNumber(e.target.value);
      if (value > C.MAX_VALUE) {
        N("æ•¸å€¼è¶…å‡ºæœ€å¤§é™åˆ¶", "warning");
        e.target.value = F.formatCurrency(C.MAX_VALUE);
      } else if (value < C.MIN_VALUE) {
        N("æ•¸å€¼è¶…å‡ºæœ€å°é™åˆ¶", "warning");
        e.target.value = F.formatCurrency(C.MIN_VALUE);
      } else {
        e.target.value = F.formatCurrency(value);
      }
    });

    input.addEventListener('blur', (e) => {
      const value = F.parseNumber(e.target.value);
      e.target.value = F.formatCurrency(value);
    });

    input.addEventListener('focus', (e) => {
      e.target.select();
    });
  });
}

function _(e){if(!e)return;const t=e.value;if(t==='')return;try{(e.classList.contains('price-input')||e.classList.contains('shipping-input')||e.classList.contains('installation-input'))&&(t=>{const r=F.parseNumber(t);return r>C.MAX_VALUE?(N("æ•¸å€¼è¶…å‡ºæœ€å¤§é™åˆ¶","warning"),e.value=F.formatCurrency(C.MAX_VALUE)):r<C.MIN_VALUE?(N("æ•¸å€¼è¶…å‡ºæœ€å°é™åˆ¶","warning"),e.value=F.formatCurrency(C.MIN_VALUE)):e.value=F.formatCurrency(r),!0})(t)}catch{e.value=F.formatCurrency(0)}}

function q(e){
  e.preventDefault();
  const t=D[e.target.id];
  if(!t) return;
  const r=d(t);
  if(!r) return;
  if('showPicker' in r) {
    r.showPicker();
  } else {
    r.focus();
    r.click();
  }
  r.dataset.pickerOpened = 'true';
}function H(e,t,r){
  if(!e||!t) return;
  
  function updateDisplayText() {
    if (t && e.value) {
      t.textContent = F.formatDate(e.value);
    }
  }
  
  function validateAndUpdate() {
    if(!t) return;
    
    const quoteDate = d('quoteDate');
    const quoteDateValue = new Date(quoteDate.value);
    const currentDate = new Date(e.value);
    
    if (e.id === 'quoteValidUntil' || e.id === 'deliveryDate') {
      if (currentDate < quoteDateValue) {
        N('æœ¬æ¬„ä½ä¸å¾—æ—©æ–¼å ±åƒ¹æ—¥', 'warning');
        
        const newDate = new Date(quoteDateValue);
        if (e.id === 'quoteValidUntil') {
          newDate.setDate(quoteDateValue.getDate() + C.DEFAULT_VALID_DAYS);
        } else if (e.id === 'deliveryDate') {
          newDate.setDate(quoteDateValue.getDate() + C.DEFAULT_DELIVERY_DAYS);
        }
        
        e.value = newDate.toISOString().split('T')[0];
        t.textContent = F.formatDate(e.value);
        return;
      }
    }
    
    if (e.id === 'quoteDate') {
      const validUntil = d('quoteValidUntil');
      const validUntilText = d('quoteValidText');
      const deliveryDate = d('deliveryDate');
      const deliveryDateText = d('deliveryDateText');

      if (validUntil && validUntilText) {
        const newValidDate = new Date(quoteDateValue);
        newValidDate.setDate(quoteDateValue.getDate() + C.DEFAULT_VALID_DAYS);
        validUntil.value = newValidDate.toISOString().split('T')[0];
        validUntilText.textContent = F.formatDate(validUntil.value);
      }

      if (deliveryDate && deliveryDateText) {
        const newDeliveryDate = new Date(quoteDateValue);
        newDeliveryDate.setDate(quoteDateValue.getDate() + C.DEFAULT_DELIVERY_DAYS);
        deliveryDate.value = newDeliveryDate.toISOString().split('T')[0];
        deliveryDateText.textContent = F.formatDate(deliveryDate.value);
      }
    }
    
    if(typeof r === 'function') {
      r.call(e);
    }
    if(e.id === 'quoteDate') {
      E();
    }
  }
  
  e.addEventListener('input', updateDisplayText);
  e.addEventListener('change', validateAndUpdate);
  e.addEventListener('blur', validateAndUpdate);
}function G(){
  const textarea = d('notes-textarea');
  if(textarea){
    textarea.addEventListener('blur', function() {
      if (this.value) {
        this.value = this.value.trim();
      }
    });
    
    textarea.addEventListener('input', function() {
      if (this.value) {
        this.value = this.value.replace(/\s+$/, '');
      }
    });
  }
}

function createMirrorPreview() {
  const originalContainer = document.querySelector('.container');
  if (!originalContainer) {
    throw new Error('æ‰¾ä¸åˆ°ä¸»å®¹å™¨');
  }
  
  const clonedContainer = originalContainer.cloneNode(true);
  
  const buttonSection = clonedContainer.querySelector('.button-section');
  if (buttonSection) {
    buttonSection.remove();
  }
  
  const controlButtons = clonedContainer.querySelectorAll('.items-controls, .row-btn');
  controlButtons.forEach(btn => btn.remove());
  
  const hiddenInputs = clonedContainer.querySelectorAll('.hidden-date-input, .upload-logo');
  hiddenInputs.forEach(input => input.remove());
  
  const inputs = clonedContainer.querySelectorAll('input');
  inputs.forEach(input => {
    const span = document.createElement('span');
    span.textContent = input.value || '';
    
    if (input.classList.contains('totals-input')) {
      span.style.cssText = `
        width: 100%;
        text-align: right;
        border: none;
        background: transparent;
        font-size: 13px;
        font-weight: 600;
        color: var(--text);
        padding: 0 5px;
        min-width: 80px;
        display: inline-block;
        min-height: 18px;
        box-sizing: border-box;
      `;
    } else {
      span.style.cssText = `
        display: inline-block;
        min-height: 14px;
        padding: 2px 4px;
        width: 100%;
        box-sizing: border-box;
        font-size: 12px;
        text-align: ${input.classList.contains('price-input') || input.classList.contains('quantity-input') || input.classList.contains('unit-input') || input.classList.contains('installation-input') || input.classList.contains('shipping-input') ? 'center' : 'left'};
        font-weight: ${input.classList.contains('price-input') ? '500' : 'normal'};
        color: ${input.classList.contains('price-input') ? 'var(--primary)' : 'var(--text)'};
      `;
    }
    input.parentNode.replaceChild(span, input);
  });
  
  const selects = clonedContainer.querySelectorAll('select');
  selects.forEach(select => {
    const span = document.createElement('span');
    const selectedOption = select.options[select.selectedIndex];
    span.textContent = selectedOption ? selectedOption.textContent : '';
    span.style.cssText = `
      font-size: 13px;
      font-weight: 600;
      color: var(--text-light);
    `;
    select.parentNode.replaceChild(span, select);
  });
  
  const textareas = clonedContainer.querySelectorAll('textarea');
  textareas.forEach(textarea => {
    const div = document.createElement('div');
    div.textContent = textarea.value || '';
    div.style.cssText = `
      width: 100%;
      padding: 8px;
      height: 100%;
      min-height: 100%;
      font-size: 12px;
      line-height: 1.3;
      font-family: Arial, sans-serif;
      border: 1px solid var(--border);
      border-radius: 4px;
      background-color: var(--bg-light);
      color: var(--text-light);
      box-sizing: border-box;
      white-space: pre-wrap;
      word-wrap: break-word;
    `;
    textarea.parentNode.replaceChild(div, textarea);
  });
  
  const editableElements = clonedContainer.querySelectorAll('[contenteditable]');
  editableElements.forEach(element => {
    element.removeAttribute('contenteditable');
    element.style.cursor = 'default';
  });
  
  const allElements = clonedContainer.querySelectorAll('*');
  allElements.forEach(element => {
    const attributes = Array.from(element.attributes);
    attributes.forEach(attr => {
      if (attr.name.startsWith('on') || attr.name.includes('data-')) {
        element.removeAttribute(attr.name);
      }
    });
  });
  
  return clonedContainer;
}

function setupButtonHandlers() {
  const previewBtn = d('previewBtn');
  const generateImageBtn = d('generateImageBtn');
  const printPdfBtn = d('printPdfBtn');

  if (!previewBtn || !generateImageBtn || !printPdfBtn) {
    console.error('Button elements not found');
    return;
  }

    previewBtn.addEventListener('click', () => {
    try {
      const clonedContainer = createMirrorPreview();
      
      const originalStyles = Array.from(document.styleSheets)
        .map(sheet => {
          try {
            return Array.from(sheet.cssRules).map(rule => rule.cssText).join('\n');
          } catch (e) {
            return '';
          }
        })
        .join('\n');
      
      const quoteNumber = d('quoteNumber')?.textContent || '9Starmax å ±åƒ¹å–®';
      const previewHTML = `
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width,initial-scale=1">
          <title>${quoteNumber}</title>
          <style>${originalStyles}</style>
        </head>
        <body>
          ${clonedContainer.outerHTML}
        </body>
        </html>
      `;
      
      const previewWindow = window.open('', '_blank');
      if (!previewWindow) {
        N('ç„¡æ³•é–‹å•Ÿé è¦½åˆ†é ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨çš„å½ˆçª—é˜»æ“‹è¨­å®š', 'warning');
        return;
      }
      
      previewWindow.document.write(previewHTML);
      previewWindow.document.close();
      
    } catch (error) {
      console.error('é è¦½åŠŸèƒ½éŒ¯èª¤:', error);
      N('é è¦½åŠŸèƒ½ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
    }
  });

  generateImageBtn.addEventListener('click', () => {
    const container = document.querySelector('.container');
    const buttonSection = container.querySelector('.button-section');
    
    if (!container || !buttonSection) {
      N('ç„¡æ³•æ‰¾åˆ°å¿…è¦çš„å…ƒç´ ', 'error');
      return;
    }
    
    window.prepareDocumentForDisplay();
    buttonSection.style.display = 'none';

    html2canvas(container, {
      scale: 6,
      useCORS: true,
      logging: false,
      allowTaint: true,
      backgroundColor: '#ffffff'
    }).then(canvas => {
      const imgData = canvas.toDataURL('image/png', 1.0);
      const link = document.createElement('a');
      link.href = imgData;
      link.download = `${d('quoteNumber').textContent || '9Starmax-quote'}.png`;
      link.click();
    }).catch(err => {
      console.error('Error generating image:', err);
      N('ç”Ÿæˆåœ–ç‰‡å¤±æ•—', 'error');
    }).finally(() => {
      buttonSection.style.display = '';
      window.restoreDocumentAfterDisplay();
    });
  });

  printPdfBtn.addEventListener('click', () => {
    window.print();
  });
}

function Q(){
  const container = document.querySelector('.container'),
        updateTotals = b(f,200),
        logoContainer = d('logo-container'),
        uploadLogo = d('upload-logo');
  
  Object.entries(D).forEach(([textId, inputId]) => {
    const textElement = d(textId);
    const inputElement = d(inputId);
    if (textElement && inputElement) {
      textElement.addEventListener('click', q);
      H(inputElement, textElement);
    }
  });

  const quoteTable = d('quoteTable');
  if (quoteTable) {
    const priceInputs = '.price-input, .shipping-input, .installation-input',
          allInputs = `${priceInputs}, .quantity-input, .category-input, .name-input, .unit-input`;
    
    function handleInput(event) {
      const target = event.target;
      if (target.matches(allInputs)) {
        if (target.value) {
          target.value = target.value.trim();
        }
        if (target.matches(priceInputs)) {
          _(target);
        }
        updateTotals();
      }
    }

    quoteTable.addEventListener('input', handleInput);
    quoteTable.addEventListener('blur', handleInput, true);
    quoteTable.addEventListener('paste', event => {
      if (event.target.matches(allInputs)) {
        setTimeout(() => handleInput(event), 0);
      }
    });

    quoteTable.addEventListener('focus', event => {
      if (event.target.tagName === 'INPUT' && event.target.matches(allInputs)) {
        event.target.select();
      }
    }, true);

    quoteTable.addEventListener('keydown', event => {
      if (event.key === 'Tab') {
        const tableBody = d('itemsTableBody');
        if (!tableBody) return;
        
        const rows = tableBody.children;
        if (!rows.length) return;
        
        const lastRow = rows[rows.length - 1];
        if (!lastRow) return;
        
        const lastInput = lastRow.querySelector('.shipping-input');
        if (!lastInput || event.target !== lastInput || event.shiftKey) return;
        
        event.preventDefault();
        v();
        setTimeout(() => {
          const newRow = tableBody.lastChild;
          if (!newRow) return;
          const firstInput = newRow.querySelector('.category-input');
          firstInput && firstInput.focus();
        }, 0);
      }
    });
  }

  function handleGlobalInput(event) {
    if (event.target.tagName === 'INPUT' && event.target.classList.contains('input-field')) {
      if (event.target.value) {
        event.target.value = event.target.value.trim();
      }
    }
  }

  document.addEventListener('input', handleGlobalInput);
  document.addEventListener('blur', handleGlobalInput, true);
  document.addEventListener('paste', event => {
    if (event.target.tagName === 'INPUT' && event.target.classList.contains('input-field')) {
      setTimeout(() => handleGlobalInput(event), 0);
    }
  });

  const addItemBtn = d('addItemBtn'),
        deleteItemBtn = d('deleteItemBtn'),
        taxTypeSelect = d('taxType');
  
  addItemBtn && addItemBtn.addEventListener('click', () => { v(); });
  deleteItemBtn && deleteItemBtn.addEventListener('click', () => {
    const tableBody = d('itemsTableBody');
    if (!tableBody) return;
    const lastRow = tableBody.lastChild;
    const rows = tableBody.children;
    rows.length > 1 ? (lastRow.remove(), updateTotals()) : N("ç„¡æ³•å…¨éƒ¨æ¸…ç©º", "warning");
  });
  taxTypeSelect && taxTypeSelect.addEventListener('change', updateTotals);
  
}

function K(){
  try{
    I();
    Q();
    setupPrintHandlers();
    g();
    f();
    G();
    setupButtonHandlers();
    setupTotalsInputs();

    const logoContainer = d('logo-container');
    const uploadLogo = d('upload-logo');
    
    if (logoContainer && uploadLogo) {
      logoContainer.addEventListener('click', () => {
        uploadLogo.click();
      });

      uploadLogo.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          if (!file.type.startsWith('image/')) {
            N('è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ', 'error');
            return;
          }
          
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxHeight = '50px';
            img.style.objectFit = 'contain';
            
            logoContainer.innerHTML = '';
            logoContainer.appendChild(img);
          };
          reader.readAsDataURL(file);
        }
      });
    }

    function setupPhoneFormatting() {
      const phoneFields = document.querySelectorAll('[data-type="phone"]');
      
      phoneFields.forEach(field => {
        let isProcessing = false;
        
        field.addEventListener('focus', function() {
          if (this.dataset.type !== 'phone') return;
          this.setAttribute('inputmode', 'tel');
        });
        
        field.addEventListener('keydown', function(e) {
          if (this.dataset.type !== 'phone') return;
          
          const allowedKeys = [
            'Backspace', 'Delete', 'Tab', 'Escape', 'Enter',
            'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
            'Home', 'End', 'PageUp', 'PageDown'
          ];
          
          const allowedChars = /[0-9+\-() #,]/;
          
          if (e.ctrlKey || e.metaKey) {
            return true;
          }
          
          if (e.key === 'Backspace' || e.key === 'Delete') {
            const selection = window.getSelection();
            const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
            
            if (range && this.firstChild) {
              const cursorPosition = range.startOffset;
              const text = this.textContent;
            }
            return true;
          }
          
          if (allowedKeys.includes(e.key)) {
            return true;
          }
          
          if (allowedChars.test(e.key)) {
            if (this.textContent.length >= 25) {
              e.preventDefault();
              return false;
            }
            return true;
          }
          
          e.preventDefault();
          return false;
        });
        
        field.addEventListener('input', function() {
          if (this.dataset.type !== 'phone') return;
          
          if (isProcessing) return;
          isProcessing = true;
          
          const selection = window.getSelection();
          const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
          const oldText = this.textContent;
          const oldCursorPosition = range && this.firstChild ? range.startOffset : 0;
          
          const cleanPhone = this.textContent.replace(/[^\d+\-() #,]/g, '');
          
          if (cleanPhone.length === 0) {
            this.textContent = '';
            isProcessing = false;
            return;
          }
          
          const formatted = F.formatText(cleanPhone, 'phone');
          
          if (formatted !== oldText) {
            let targetPosition = 0;
            
            if (cleanPhone.length > oldText.replace(/[^\d+\-() #,]/g, '').length) {
              targetPosition = formatted.length;
            } else {
              targetPosition = Math.min(oldCursorPosition, formatted.length);
            }
            
            this.textContent = formatted;
            
            if (this.firstChild && this.firstChild.nodeType === Node.TEXT_NODE) {
              try {
                const textNode = this.firstChild;
                const newRange = document.createRange();
                const newSelection = window.getSelection();
                
                const safePosition = Math.min(Math.max(0, targetPosition), formatted.length);
                
                newRange.setStart(textNode, safePosition);
                newRange.setEnd(textNode, safePosition);
                newSelection.removeAllRanges();
                newSelection.addRange(newRange);
              } catch (e) {
              }
            }
          }
          
          setTimeout(() => {
            isProcessing = false;
          }, 10);
        });
        
        field.addEventListener('blur', function() {
          if (this.dataset.type !== 'phone') return;
          
          const cleanPhone = this.textContent.replace(/[^\d+\-() #,]/g, '').trim();
          const formatted = F.formatText(cleanPhone, 'phone');
          this.textContent = formatted;
        });
        
        field.addEventListener('paste', function(e) {
          if (this.dataset.type !== 'phone') return;
          
          e.preventDefault();
          const paste = (e.clipboardData || window.clipboardData).getData('text');
          const cleanPhone = paste.replace(/[^\d+\-() #,]/g, '').trim();
          const formatted = F.formatText(cleanPhone, 'phone');
          this.textContent = formatted;
          
          this.dispatchEvent(new Event('input', { bubbles: true }));
        });
      });
    }
    
    const contactInfo = document.querySelector('.contact-info');
    const clientConfirmation = document.querySelector('.client-confirmation');
    
    if (contactInfo && clientConfirmation) {
      const contactFields = contactInfo.querySelectorAll('.editable-field');
      const clientFields = clientConfirmation.querySelectorAll('.editable-field');
      
      function syncContent(sourceField, targetField) {
        if (sourceField && targetField) {
          const content = sourceField.textContent.trim();
          if (content) {
            if (sourceField.dataset.type === 'phone') {
              targetField.textContent = F.formatText(content, 'phone');
            } else {
              targetField.textContent = content;
            }
          }
        }
      }
      
      contactFields.forEach((field, index) => {
        field.addEventListener('input', () => {
          syncContent(field, clientFields[index]);
        });
        
        field.addEventListener('blur', () => {
          syncContent(field, clientFields[index]);
        });
      });
    }
    
    setupPhoneFormatting();
  }catch{}
}
K();
});
</script>
</body>
</html> 